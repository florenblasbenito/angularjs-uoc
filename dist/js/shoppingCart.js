function shoppingCart(t){this.cartauthor=t,this.clearCart=!1,this.checkoutParameters={},this.items=[],this.loadItems();var e=this;$(window).unload(function(){e.clearCart&&e.clearItems(),e.saveItems(),e.clearCart=!1})}function checkoutParameters(t,e,r){this.serviceauthor=t,this.merchantID=e,this.options=r}function cartItem(t,e,r,i){this.id=t,this.author=e,this.price=1*r,this.quantity=1*i}shoppingCart.prototype.loadItems=function(){var t=null!=localStorage?localStorage[this.cartauthor+"_items"]:null;if(null!=t&&null!=JSON)try{for(var t=JSON.parse(t),e=0;e<t.length;e++){var r=t[e];null!=r.id&&null!=r.author&&null!=r.price&&null!=r.quantity&&(r=new cartItem(r.id,r.author,r.price,r.quantity),this.items.push(r))}}catch(i){}},shoppingCart.prototype.saveItems=function(){null!=localStorage&&null!=JSON&&(localStorage[this.cartauthor+"_items"]=JSON.stringify(this.items))},shoppingCart.prototype.addItem=function(t,e,r,i){if(i=this.toNumber(i),0!=i){for(var a=!1,o=0;o<this.items.length&&!a;o++){var s=this.items[o];s.id==t&&(a=!0,s.quantity=this.toNumber(s.quantity+i),s.quantity<=0&&this.items.splice(o,1))}if(!a){var s=new cartItem(t,e,r,i);this.items.push(s)}this.saveItems()}},shoppingCart.prototype.getTotalPrice=function(t){for(var e=0,r=0;r<this.items.length;r++){var i=this.items[r];null!=t&&i.id!=t||(e+=this.toNumber(i.quantity*i.price))}return e},shoppingCart.prototype.getTotalCount=function(t){for(var e=0,r=0;r<this.items.length;r++){var i=this.items[r];null!=t&&i.id!=t||(e+=this.toNumber(i.quantity))}return e},shoppingCart.prototype.clearItems=function(){this.items=[],this.saveItems()},shoppingCart.prototype.addCheckoutParameters=function(t,e,r){if("PayPal"!=t&&"Google"!=t&&"Stripe"!=t)throw"serviceauthor must be 'PayPal' or 'Google' or 'Stripe'.";if(null==e)throw"A merchantID is required in order to checkout.";this.checkoutParameters[t]=new checkoutParameters(t,e,r)},shoppingCart.prototype.checkout=function(t,e){if(null==t){var r=this.checkoutParameters[Object.keys(this.checkoutParameters)[0]];t=r.serviceauthor}if(null==t)throw"Use the 'addCheckoutParameters' method to define at least one checkout service.";var i=this.checkoutParameters[t];if(null==i)throw"Cannot get checkout parameters for '"+t+"'.";switch(i.serviceauthor){case"PayPal":this.checkoutPayPal(i,e);break;default:throw"Unknown checkout service: "+i.serviceauthor}},shoppingCart.prototype.checkoutPayPal=function(t,e){for(var r={cmd:"_cart",business:t.merchantID,upload:"1",rm:"2",charset:"utf-8"},i=0;i<this.items.length;i++){var a=this.items[i],o=i+1;r["item_number_"+o]=a.id,r["item_author_"+o]=a.author,r["quantity_"+o]=a.quantity,r["amount_"+o]=a.price.toFixed(2)}var s=$("<form/></form>");s.attr("action","https://www.paypal.com/cgi-bin/webscr"),s.attr("method","POST"),s.attr("style","display:none;"),this.addFormFields(s,r),this.addFormFields(s,t.options),$("body").append(s),this.clearCart=null==e||e,s.submit(),s.remove()},shoppingCart.prototype.addFormFields=function(t,e){null!=e&&$.each(e,function(e,r){if(null!=r){var i=$("<input></input>").attr("type","hidden").attr("author",e).val(r);t.append(i)}})},shoppingCart.prototype.toNumber=function(t){return t=1*t,isNaN(t)?0:t};
//# sourceMappingURL=maps/shoppingCart.js.map
